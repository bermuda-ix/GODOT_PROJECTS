[gd_resource type="BehaviorTree" load_steps=92 format=3 uid="uid://c73vwom3cvpxj"]

[ext_resource type="Script" uid="uid://w637xlbev2om" path="res://ai/tasks/find_player.gd" id="1_7h010"]
[ext_resource type="Script" uid="uid://cov8ln83btwt8" path="res://ai/tasks/chase_player.gd" id="2_4ykdd"]
[ext_resource type="Script" uid="uid://dwx32cqb0l4t5" path="res://ai/tasks/flee_player.gd" id="2_bl5of"]
[ext_resource type="Script" uid="uid://bjq0mdyt8cyi2" path="res://ai/tasks/within_range.gd" id="3_nv67j"]
[ext_resource type="Script" uid="uid://c5vs4nrkjqj0t" path="res://ai/tasks/keep_range.gd" id="4_sosob"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_ewtji"]
var/stunned/name = &"stunned"
var/stunned/type = 1
var/stunned/value = false
var/stunned/hint = 0
var/stunned/hint_string = ""
var/flee/name = &"flee"
var/flee/type = 1
var/flee/value = false
var/flee/hint = 0
var/flee/hint_string = ""
var/full_combo/name = &"full_combo"
var/full_combo/type = 1
var/full_combo/value = false
var/full_combo/hint = 0
var/full_combo/hint_string = ""
var/light_attack/name = &"light_attack"
var/light_attack/type = 1
var/light_attack/value = false
var/light_attack/hint = 0
var/light_attack/hint_string = ""
var/phase/name = &"phase"
var/phase/type = 2
var/phase/value = 0
var/phase/hint = 0
var/phase/hint_string = ""
var/charge/name = &"charge"
var/charge/type = 1
var/charge/value = false
var/charge/hint = 0
var/charge/hint_string = ""
var/attack_timer/name = &"attack_timer"
var/attack_timer/type = 1
var/attack_timer/value = false
var/attack_timer/hint = 0
var/attack_timer/hint_string = ""
var/multi_shot/name = &"multi_shot"
var/multi_shot/type = 1
var/multi_shot/value = false
var/multi_shot/hint = 0
var/multi_shot/hint_string = ""
var/final_hit/name = &"final_hit"
var/final_hit/type = 1
var/final_hit/value = false
var/final_hit/hint = 0
var/final_hit/hint_string = ""

[sub_resource type="BTCheckTrigger" id="BTCheckTrigger_va6io"]
variable = &"flee"

[sub_resource type="BTAction" id="BTAction_o2nbj"]
script = ExtResource("1_7h010")
group = &""
target_var = &"target"

[sub_resource type="BTAction" id="BTAction_ejg2e"]
script = ExtResource("2_bl5of")
target_var = &"target"
speed_var = 60
tolerance = 250

[sub_resource type="BBNode" id="BBNode_koiey"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_miwbh"]
animation_player = SubResource("BBNode_koiey")
animation_name = &"RESET"

[sub_resource type="BTSequence" id="BTSequence_33rq8"]
custom_name = "Flee"
children = [SubResource("BTCheckTrigger_va6io"), SubResource("BTAction_o2nbj"), SubResource("BTAction_ejg2e"), SubResource("BTPlayAnimation_miwbh")]

[sub_resource type="BTCheckTrigger" id="BTCheckTrigger_b28o3"]
variable = &"stunned"

[sub_resource type="BTWait" id="BTWait_me2xo"]
duration = 3.0

[sub_resource type="BBVariant" id="BBVariant_kj0oc"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTSetVar" id="BTSetVar_gxaq8"]
variable = &"light_attack"
value = SubResource("BBVariant_kj0oc")

[sub_resource type="BBVariant" id="BBVariant_p2t7x"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTSetVar" id="BTSetVar_pewli"]
variable = &"flee"
value = SubResource("BBVariant_p2t7x")

[sub_resource type="BBVariant" id="BBVariant_2mqon"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTSetVar" id="BTSetVar_4gtqa"]
variable = &"full_combo"
value = SubResource("BBVariant_2mqon")

[sub_resource type="BTSequence" id="BTSequence_meyx0"]
custom_name = "Stunned"
children = [SubResource("BTCheckTrigger_b28o3"), SubResource("BTWait_me2xo"), SubResource("BTSetVar_gxaq8"), SubResource("BTSetVar_pewli"), SubResource("BTSetVar_4gtqa")]

[sub_resource type="BBVariant" id="BBVariant_rm4n4"]
type = 2
saved_value = 0
resource_name = "0"

[sub_resource type="BTCheckVar" id="BTCheckVar_yhs3h"]
variable = &"phase"
value = SubResource("BBVariant_rm4n4")

[sub_resource type="BTAction" id="BTAction_tycts"]
script = ExtResource("1_7h010")
group = &"player"
target_var = &"target"

[sub_resource type="BTAction" id="BTAction_k5yrd"]
script = ExtResource("3_nv67j")
target_var = &"target"
range = 40

[sub_resource type="BTCallMethod" id="BTCallMethod_fthev"]
method = &"attack_combo"

[sub_resource type="BTSequence" id="BTSequence_1q3mw"]
custom_name = "Full Combo"
children = [SubResource("BTAction_tycts"), SubResource("BTAction_k5yrd"), SubResource("BTCallMethod_fthev")]

[sub_resource type="BTAction" id="BTAction_d246x"]
script = ExtResource("1_7h010")
group = &"player"
target_var = &"target"

[sub_resource type="BTAction" id="BTAction_aatcr"]
script = ExtResource("2_4ykdd")
target_var = &"target"
speed_var = 60
tolerance = 40

[sub_resource type="BTSequence" id="BTSequence_gwxtd"]
custom_name = "Chase Player"
children = [SubResource("BTAction_d246x"), SubResource("BTAction_aatcr")]

[sub_resource type="BTSelector" id="BTSelector_qwgg4"]
children = [SubResource("BTSequence_1q3mw"), SubResource("BTSequence_gwxtd")]

[sub_resource type="BTSequence" id="BTSequence_apnts"]
custom_name = "Phase1"
children = [SubResource("BTCheckVar_yhs3h"), SubResource("BTSelector_qwgg4")]

[sub_resource type="BBVariant" id="BBVariant_di7pp"]
type = 2
saved_value = 1
resource_name = "1"

[sub_resource type="BTCheckVar" id="BTCheckVar_jmiw3"]
variable = &"phase"
value = SubResource("BBVariant_di7pp")

[sub_resource type="BTCheckTrigger" id="BTCheckTrigger_voxb5"]
variable = &"attack_timer"

[sub_resource type="BTAction" id="BTAction_61o0w"]
script = ExtResource("1_7h010")
group = &"player"
target_var = &"target"

[sub_resource type="BBNode" id="BBNode_75mhd"]
saved_value = NodePath(".")
resource_name = "."

[sub_resource type="BTCallMethod" id="BTCallMethod_fu5t4"]
node = SubResource("BBNode_75mhd")
method = &"light_attack"

[sub_resource type="BBNode" id="BBNode_3lhtu"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTAwaitAnimation" id="BTAwaitAnimation_hrsbk"]
animation_player = SubResource("BBNode_3lhtu")
animation_name = &"light_attack"
max_time = 0.5

[sub_resource type="BBNode" id="BBNode_xayix"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPauseAnimation" id="BTPauseAnimation_wq67k"]
animation_player = SubResource("BBNode_xayix")

[sub_resource type="BBVariant" id="BBVariant_xotmt"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTSetVar" id="BTSetVar_lc7bw"]
variable = &"charge"
value = SubResource("BBVariant_xotmt")

[sub_resource type="BTAction" id="BTAction_fa0m7"]
script = ExtResource("2_4ykdd")
target_var = &"target"
speed_var = 200
tolerance = 20

[sub_resource type="BTConsolePrint" id="BTConsolePrint_5pog1"]
text = "charging"

[sub_resource type="BTAction" id="BTAction_o1vru"]
script = ExtResource("3_nv67j")
target_var = &"target"
range = 20

[sub_resource type="BTConsolePrint" id="BTConsolePrint_0m5s0"]
text = "hit"

[sub_resource type="BBVariant" id="BBVariant_y2tff"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTSetVar" id="BTSetVar_j3kwk"]
variable = &"light_attack"
value = SubResource("BBVariant_y2tff")

[sub_resource type="BBVariant" id="BBVariant_mnjr2"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTSetVar" id="BTSetVar_ga2ax"]
variable = &"charge"
value = SubResource("BBVariant_mnjr2")

[sub_resource type="BBVariant" id="BBVariant_8u2ex"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTSetVar" id="BTSetVar_0gmyb"]
variable = &"attack_timer"
value = SubResource("BBVariant_8u2ex")

[sub_resource type="BTStopAnimation" id="BTStopAnimation_xkdiq"]

[sub_resource type="BTSequence" id="BTSequence_4kra6"]
custom_name = "Attack Player"
children = [SubResource("BTCheckTrigger_voxb5"), SubResource("BTAction_61o0w"), SubResource("BTCallMethod_fu5t4"), SubResource("BTAwaitAnimation_hrsbk"), SubResource("BTPauseAnimation_wq67k"), SubResource("BTSetVar_lc7bw"), SubResource("BTAction_fa0m7"), SubResource("BTConsolePrint_5pog1"), SubResource("BTAction_o1vru"), SubResource("BTConsolePrint_0m5s0"), SubResource("BTSetVar_j3kwk"), SubResource("BTSetVar_ga2ax"), SubResource("BTSetVar_0gmyb"), SubResource("BTStopAnimation_xkdiq")]

[sub_resource type="BTProbability" id="BTProbability_amx5k"]
children = [SubResource("BTSequence_4kra6")]

[sub_resource type="BTAction" id="BTAction_p4nv7"]
script = ExtResource("1_7h010")
group = &"player"
target_var = &"target"

[sub_resource type="BTAction" id="BTAction_eq0q8"]
script = ExtResource("4_sosob")
target_var = &"target"
speed_var = 60
tolerance = 120
max_range = 150

[sub_resource type="BBVariant" id="BBVariant_qg4kb"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTSetVar" id="BTSetVar_p2jry"]
variable = &"flee"
value = SubResource("BBVariant_qg4kb")

[sub_resource type="BBVariant" id="BBVariant_boef1"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTSetVar" id="BTSetVar_jfp08"]
variable = &"light_attack"
value = SubResource("BBVariant_boef1")

[sub_resource type="BTSequence" id="BTSequence_ma0ac"]
custom_name = "Flee"
children = [SubResource("BTAction_p4nv7"), SubResource("BTAction_eq0q8"), SubResource("BTSetVar_p2jry"), SubResource("BTSetVar_jfp08")]

[sub_resource type="BTProbability" id="BTProbability_b65ni"]
run_chance = 1.0
children = [SubResource("BTSequence_ma0ac")]

[sub_resource type="BTSelector" id="BTSelector_bj2yc"]
children = [SubResource("BTProbability_amx5k"), SubResource("BTProbability_b65ni")]

[sub_resource type="BTSequence" id="BTSequence_f8es7"]
custom_name = "Phase2"
children = [SubResource("BTCheckVar_jmiw3"), SubResource("BTSelector_bj2yc")]

[sub_resource type="BBVariant" id="BBVariant_tc05q"]
type = 2
saved_value = 2
resource_name = "2"

[sub_resource type="BTCheckVar" id="BTCheckVar_dxs17"]
variable = &"phase"
value = SubResource("BBVariant_tc05q")

[sub_resource type="BTCheckTrigger" id="BTCheckTrigger_1p7ro"]
variable = &"final_hit"

[sub_resource type="BTAction" id="BTAction_m3t3p"]
script = ExtResource("1_7h010")
group = &"player"
target_var = &"target"

[sub_resource type="BTAction" id="BTAction_aa6w0"]
script = ExtResource("3_nv67j")
target_var = &"target"
range = 40

[sub_resource type="BBNode" id="BBNode_xdka3"]
saved_value = NodePath(".")
resource_name = "."

[sub_resource type="BTCallMethod" id="BTCallMethod_e566s"]
node = SubResource("BBNode_xdka3")
method = &"attack_combo"

[sub_resource type="BTSequence" id="BTSequence_g6qnd"]
custom_name = "Full Combo"
children = [SubResource("BTAction_m3t3p"), SubResource("BTAction_aa6w0"), SubResource("BTCallMethod_e566s")]

[sub_resource type="BTAction" id="BTAction_dwpi8"]
script = ExtResource("1_7h010")
group = &"player"
target_var = &"target"

[sub_resource type="BTAction" id="BTAction_faqkh"]
script = ExtResource("2_4ykdd")
target_var = &"target"
speed_var = 150
tolerance = 40

[sub_resource type="BTSequence" id="BTSequence_2qnwk"]
custom_name = "Chase Player"
children = [SubResource("BTAction_dwpi8"), SubResource("BTAction_faqkh")]

[sub_resource type="BTSelector" id="BTSelector_v6xmm"]
custom_name = "Full Combo Attack"
children = [SubResource("BTSequence_g6qnd"), SubResource("BTSequence_2qnwk")]

[sub_resource type="BTSequence" id="BTSequence_ahi26"]
children = [SubResource("BTCheckTrigger_1p7ro"), SubResource("BTSelector_v6xmm")]

[sub_resource type="BTCheckTrigger" id="BTCheckTrigger_suwgs"]
variable = &"multi_shot"

[sub_resource type="BTConsolePrint" id="BTConsolePrint_5ps8n"]
text = "shooting"

[sub_resource type="BBVariant" id="BBVariant_pf2ws"]
type = 3
saved_value = 10.0
resource_name = "10"

[sub_resource type="BBNode" id="BBNode_0nldh"]
saved_value = NodePath(".")
resource_name = "."

[sub_resource type="BTCallMethod" id="BTCallMethod_wxvim"]
node = SubResource("BBNode_0nldh")
method = &"spread_shot"
args = Array[BBVariant]([SubResource("BBVariant_pf2ws")])

[sub_resource type="BTSequence" id="BTSequence_50qgl"]
children = [SubResource("BTCallMethod_wxvim")]

[sub_resource type="BTCooldown" id="BTCooldown_7bdlg"]
duration = 1.0
start_cooled = true
children = [SubResource("BTSequence_50qgl")]

[sub_resource type="BTSequence" id="BTSequence_kewr2"]
custom_name = "Final Attack - Shooting"
children = [SubResource("BTCheckTrigger_suwgs"), SubResource("BTConsolePrint_5ps8n"), SubResource("BTCooldown_7bdlg")]

[sub_resource type="BTSelector" id="BTSelector_a0y1p"]
children = [SubResource("BTSequence_ahi26"), SubResource("BTSequence_kewr2")]

[sub_resource type="BTSequence" id="BTSequence_5akle"]
custom_name = "Phase 3"
children = [SubResource("BTCheckVar_dxs17"), SubResource("BTSelector_a0y1p")]

[sub_resource type="BTSelector" id="BTSelector_ne57j"]
children = [SubResource("BTSequence_33rq8"), SubResource("BTSequence_meyx0"), SubResource("BTSequence_apnts"), SubResource("BTSequence_f8es7"), SubResource("BTSequence_5akle")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_ewtji")
root_task = SubResource("BTSelector_ne57j")
