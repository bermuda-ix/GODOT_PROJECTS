[gd_resource type="BehaviorTree" load_steps=52 format=3 uid="uid://bkpyddqh402xp"]

[ext_resource type="Script" uid="uid://w637xlbev2om" path="res://ai/tasks/find_player.gd" id="1_7px3v"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_2djuw"]
var/attack_mode/name = &"attack_mode"
var/attack_mode/type = 1
var/attack_mode/value = false
var/attack_mode/hint = 0
var/attack_mode/hint_string = ""
var/ranged_mode/name = &"ranged_mode"
var/ranged_mode/type = 1
var/ranged_mode/value = false
var/ranged_mode/hint = 0
var/ranged_mode/hint_string = ""
var/melee_mode/name = &"melee_mode"
var/melee_mode/type = 1
var/melee_mode/value = false
var/melee_mode/hint = 0
var/melee_mode/hint_string = ""
var/within_range/name = &"within_range"
var/within_range/type = 1
var/within_range/value = false
var/within_range/hint = 0
var/within_range/hint_string = ""
var/counter_attack/name = &"counter_attack"
var/counter_attack/type = 1
var/counter_attack/value = false
var/counter_attack/hint = 0
var/counter_attack/hint_string = ""
var/a/name = &"a"
var/a/type = 3
var/a/value = 0.0
var/a/hint = 0
var/a/hint_string = ""

[sub_resource type="BBVariant" id="BBVariant_s1wjr"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_or1gh"]
variable = &"attack_mode"
value = SubResource("BBVariant_s1wjr")
custom_name = "AttackMode"

[sub_resource type="BBVariant" id="BBVariant_ex4gl"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_gi26e"]
variable = &"within_range"
value = SubResource("BBVariant_ex4gl")

[sub_resource type="BTAction" id="BTAction_2i8b5"]
script = ExtResource("1_7px3v")
group = &"player"
target_var = &"target"

[sub_resource type="BTCheckTrigger" id="BTCheckTrigger_vjri2"]
variable = &"counter_attack"

[sub_resource type="BBNode" id="BBNode_vjri2"]
saved_value = NodePath("MeleeAttackManager")
resource_name = "MeleeAttackManager"

[sub_resource type="BTCallMethod" id="BTCallMethod_wr2jt"]
node = SubResource("BBNode_vjri2")
method = &"melee_counter"

[sub_resource type="BBNode" id="BBNode_cj7pg"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTAwaitAnimation" id="BTAwaitAnimation_qpg7m"]
animation_player = SubResource("BBNode_cj7pg")
animation_name = &"atk_counter"
max_time = 5.0

[sub_resource type="BTSequence" id="BTSequence_wr2jt"]
custom_name = "CounterKick"
children = [SubResource("BTCallMethod_wr2jt"), SubResource("BTAwaitAnimation_qpg7m")]

[sub_resource type="BTProbability" id="BTProbability_vjri2"]
custom_name = "counter_kick_weight"
children = [SubResource("BTSequence_wr2jt")]

[sub_resource type="BBNode" id="BBNode_wr2jt"]
saved_value = NodePath("DodgeManager")
resource_name = "DodgeManager"

[sub_resource type="BTCallMethod" id="BTCallMethod_qkysk"]
node = SubResource("BBNode_wr2jt")
method = &"dodge"

[sub_resource type="BBNode" id="BBNode_qkysk"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTAwaitAnimation" id="BTAwaitAnimation_cj7pg"]
animation_player = SubResource("BBNode_qkysk")
animation_name = &"dodge"
max_time = 0.2

[sub_resource type="BBNode" id="BBNode_qpg7m"]
saved_value = NodePath("ShootAttackManager")
resource_name = "ShootAttackManager"

[sub_resource type="BTCallMethod" id="BTCallMethod_xienf"]
node = SubResource("BBNode_qpg7m")
method = &"shoot"

[sub_resource type="BTWait" id="BTWait_vjri2"]
duration = 0.2

[sub_resource type="BTSequence" id="BTSequence_cj7pg"]
children = [SubResource("BTCallMethod_xienf"), SubResource("BTWait_vjri2")]

[sub_resource type="BTRepeat" id="BTRepeat_cj7pg"]
times = 3
children = [SubResource("BTSequence_cj7pg")]

[sub_resource type="BTSequence" id="BTSequence_qpg7m"]
custom_name = "CounterShoot"
children = [SubResource("BTCallMethod_qkysk"), SubResource("BTAwaitAnimation_cj7pg"), SubResource("BTRepeat_cj7pg")]

[sub_resource type="BTProbability" id="BTProbability_cj7pg"]
run_chance = 1.0
custom_name = "counter_shoot_weight"
children = [SubResource("BTSequence_qpg7m")]

[sub_resource type="BTSelector" id="BTSelector_vjri2"]
custom_name = "CounterTypes"
children = [SubResource("BTProbability_vjri2"), SubResource("BTProbability_cj7pg")]

[sub_resource type="BTSequence" id="BTSequence_qkysk"]
custom_name = "CounterAttack"
children = [SubResource("BTCheckTrigger_vjri2"), SubResource("BTSelector_vjri2")]

[sub_resource type="BBVariant" id="BBVariant_eahdn"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_aa25s"]
variable = &"melee_mode"
value = SubResource("BBVariant_eahdn")

[sub_resource type="BBNode" id="BBNode_ysbiq"]
saved_value = NodePath("MeleeAttackManager")
resource_name = "MeleeAttackManager"

[sub_resource type="BTCallMethod" id="BTCallMethod_qwr6t"]
node = SubResource("BBNode_ysbiq")
method = &"melee_attack"

[sub_resource type="BTSequence" id="BTSequence_yfw6d"]
custom_name = "Attack"
children = [SubResource("BTCheckVar_aa25s"), SubResource("BTCallMethod_qwr6t")]

[sub_resource type="BTCooldown" id="BTCooldown_5mvyu"]
duration = 0.8
start_cooled = true
children = [SubResource("BTSequence_yfw6d")]

[sub_resource type="BTSelector" id="BTSelector_qpg7m"]
custom_name = "attacks"
children = [SubResource("BTSequence_qkysk"), SubResource("BTCooldown_5mvyu")]

[sub_resource type="BTSequence" id="BTSequence_7vhxb"]
custom_name = "AttackRange"
children = [SubResource("BTCheckVar_gi26e"), SubResource("BTAction_2i8b5"), SubResource("BTSelector_qpg7m")]

[sub_resource type="BTAction" id="BTAction_kugyc"]
script = ExtResource("1_7px3v")
group = &"player"
target_var = &"target"

[sub_resource type="BBNode" id="BBNode_hd7qm"]
saved_value = NodePath("")

[sub_resource type="BTCallMethod" id="BTCallMethod_ok4as"]
node = SubResource("BBNode_hd7qm")
method = &"chase"

[sub_resource type="BTSequence" id="BTSequence_5qq8g"]
custom_name = "Get In Range"
children = [SubResource("BTAction_kugyc"), SubResource("BTCallMethod_ok4as")]

[sub_resource type="BTSelector" id="BTSelector_3ojif"]
custom_name = "Getting in range"
children = [SubResource("BTSequence_7vhxb"), SubResource("BTSequence_5qq8g")]

[sub_resource type="BTSequence" id="BTSequence_c1urr"]
custom_name = "Melee"
children = [SubResource("BTSelector_3ojif")]

[sub_resource type="BBVariant" id="BBVariant_wptbb"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_1cp6n"]
variable = &"ranged_mode"
value = SubResource("BBVariant_wptbb")

[sub_resource type="BBNode" id="BBNode_4kawb"]
saved_value = NodePath("ShootAttackManager")
resource_name = "ShootAttackManager"

[sub_resource type="BTCallMethod" id="BTCallMethod_kmg6s"]
node = SubResource("BBNode_4kawb")
method = &"shoot"

[sub_resource type="BTSequence" id="BTSequence_p3l4r"]
custom_name = "Shoot"
children = [SubResource("BTCheckVar_1cp6n"), SubResource("BTCallMethod_kmg6s")]

[sub_resource type="BTCooldown" id="BTCooldown_ufwxr"]
duration = 0.5
start_cooled = true
children = [SubResource("BTSequence_p3l4r")]

[sub_resource type="BTSelector" id="BTSelector_ct688"]
children = [SubResource("BTSequence_c1urr"), SubResource("BTCooldown_ufwxr")]

[sub_resource type="BTRepeatUntilFailure" id="BTRepeatUntilFailure_vwcxk"]
children = [SubResource("BTSelector_ct688")]

[sub_resource type="BTSequence" id="BTSequence_df28b"]
custom_name = "Attacks"
children = [SubResource("BTCheckVar_or1gh"), SubResource("BTRepeatUntilFailure_vwcxk")]

[sub_resource type="BTSelector" id="BTSelector_307xj"]
children = [SubResource("BTSequence_df28b")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_2djuw")
root_task = SubResource("BTSelector_307xj")
